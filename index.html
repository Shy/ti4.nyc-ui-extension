<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Twilight Imperium 4th Edition Match Log</title>
    <link rel="stylesheet" href="https://contentful.github.io/ui-extensions-sdk/cf-extension.css">
    <script src="https://unpkg.com/contentful-ui-extensions-sdk@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <style type="text/css">
    .inline {
        display: inline-block;
    }

    .player {
        padding-bottom: 1px;
    }

    .icon{
        width: 18px;
        height: 18px;
        display: inline-block;
    }
    </style>
</head>

<body>
    <div id="content">
        <div class="player">
            <img class="icon" id="player1Icon" src="/icons/arborec.png">
            <div class="cf-form-field inline">
                <label>Players</label>
                <input type="text" value="Player 1 Name" class="cf-form-input inline" id="player1Name">
            </div>
            <div class="cf-form-field inline">
                <label>Points</label>
                <input type="integer" value="1" class="cf-form-input inline" id="player1Score">
            </div>
            <div class="cf-form-field inline">
                <label>Factions</label>
                <select class="cf-form-input" id="player1Faction">
                    <option value="Arborec" selected>The Arborec</option>
                    <option value="Barony">The Barony of Letnev</option>
                    <option value="Saar">The Clan of Saar </option>
                    <option value="Muaat">The Embers of Muaat</option>
                    <option value="Hacan">The Emirates of Hacan</option>
                    <option value="Sol">The Federation of Sol </option>
                    <option value="Ghosts">The Ghosts of Creuss</option>
                    <option value="L1Z1X">The L1Z1X Mindnet</option>
                    <option value="Mentak">The Mentak Coalition</option>
                    <option value="Naalu">The Naalu Collective </option>
                    <option value="Nekro">The Nekro Virus</option>
                    <option value="Sardakk">The Sardakk N’orr</option>
                    <option value="Jol-Nar">The Universities of Jol-Nar</option>
                    <option value="Winnu">The Winnu</option>
                    <option value="Xxcha">The Xxcha Kingdom</option>
                    <option value="Yin">The Yin Brotherhood</option>
                    <option value="Yssaril ">The Yssaril Tribes </option>
                </select>
            </div>
        </div>
        <div class="player">
            <img class="icon" id="player2Icon" src="/icons/saar.png">
            <div class="cf-form-field inline">
                <input type="text" value="Player 2 Name" class="cf-form-input inline" id="player2Name">
            </div>
            <div class="cf-form-field inline">
                <input type="integer" value="2" class="cf-form-input inline" id="player2Score">
            </div>
            <div class="cf-form-field inline">
                <select class="cf-form-input" id="player2Faction">
                    <option value="Arborec">The Arborec</option>
                    <option value="Barony">The Barony of Letnev</option>
                    <option value="Saar" selected>The Clan of Saar </option>
                    <option value="Muaat">The Embers of Muaat</option>
                    <option value="Hacan">The Emirates of Hacan</option>
                    <option value="Sol">The Federation of Sol </option>
                    <option value="Ghosts">The Ghosts of Creuss</option>
                    <option value="L1Z1X">The L1Z1X Mindnet</option>
                    <option value="Mentak">The Mentak Coalition</option>
                    <option value="Naalu">The Naalu Collective </option>
                    <option value="Nekro">The Nekro Virus</option>
                    <option value="Sardakk">The Sardakk N’orr</option>
                    <option value="Jol-Nar">The Universities of Jol-Nar</option>
                    <option value="Winnu">The Winnu</option>
                    <option value="Xxcha">The Xxcha Kingdom</option>
                    <option value="Yin">The Yin Brotherhood</option>
                    <option value="Yssaril ">The Yssaril Tribes </option>
                </select>
            </div>
        </div>
        <div class="player">
            <img class="icon" id="player3Icon" src="/icons/hacan.png">
            <div class="cf-form-field inline">
                <input type="text" value="Player 3 Name" class="cf-form-input inline" id="player3Name">
            </div>
            <div class="cf-form-field inline">
                <input type="integer" value="3" class="cf-form-input inline" id="player3Score">
            </div>
            <div class="cf-form-field inline">
                <select class="cf-form-input" id="player3Faction">
                    <option value="Arborec">The Arborec</option>
                    <option value="Barony">The Barony of Letnev</option>
                    <option value="Saar">The Clan of Saar </option>
                    <option value="Muaat">The Embers of Muaat</option>
                    <option value="Hacan" selected>The Emirates of Hacan</option>
                    <option value="Sol">The Federation of Sol </option>
                    <option value="Ghosts">The Ghosts of Creuss</option>
                    <option value="L1Z1X">The L1Z1X Mindnet</option>
                    <option value="Mentak">The Mentak Coalition</option>
                    <option value="Naalu">The Naalu Collective </option>
                    <option value="Nekro">The Nekro Virus</option>
                    <option value="Sardakk">The Sardakk N’orr</option>
                    <option value="Jol-Nar">The Universities of Jol-Nar</option>
                    <option value="Winnu">The Winnu</option>
                    <option value="Xxcha">The Xxcha Kingdom</option>
                    <option value="Yin">The Yin Brotherhood</option>
                    <option value="Yssaril ">The Yssaril Tribes </option>
                </select>
            </div>
        </div>
        <div class="player">
            <img class="icon" id="player4Icon" src="/icons/sol.png">
            <div class="cf-form-field inline">
                <input type="text" value="Player 4 Name" class="cf-form-input inline" id="player4Name">
            </div>
            <div class="cf-form-field inline">
                <input type="integer" value="4" class="cf-form-input inline" id="player4Score">
            </div>
            <div class="cf-form-field inline">
                <select class="cf-form-input" id="player4Faction">
                    <option value="Arborec">The Arborec</option>
                    <option value="Barony">The Barony of Letnev</option>
                    <option value="Saar">The Clan of Saar </option>
                    <option value="Muaat">The Embers of Muaat</option>
                    <option value="Hacan">The Emirates of Hacan</option>
                    <option value="Sol" selected>The Federation of Sol </option>
                    <option value="Ghosts">The Ghosts of Creuss</option>
                    <option value="L1Z1X">The L1Z1X Mindnet</option>
                    <option value="Mentak">The Mentak Coalition</option>
                    <option value="Naalu">The Naalu Collective </option>
                    <option value="Nekro">The Nekro Virus</option>
                    <option value="Sardakk">The Sardakk N’orr</option>
                    <option value="Jol-Nar">The Universities of Jol-Nar</option>
                    <option value="Winnu">The Winnu</option>
                    <option value="Xxcha">The Xxcha Kingdom</option>
                    <option value="Yin">The Yin Brotherhood</option>
                    <option value="Yssaril ">The Yssaril Tribes </option>
                </select>
            </div>
        </div>
        <div class="player">
            <img class="icon" id="player5Icon" src="/icons/ghosts.png">
            <div class="cf-form-field inline">
                <input type="text" value="Player 5 Name" class="cf-form-input inline" id="player5Name">
            </div>
            <div class="cf-form-field inline">
                <input type="integer" value="5" class="cf-form-input inline" id="player5Score">
            </div>
            <div class="cf-form-field inline">
                <select class="cf-form-input" id="player5Faction">
                    <option value="Arborec">The Arborec</option>
                    <option value="Barony">The Barony of Letnev</option>
                    <option value="Saar">The Clan of Saar </option>
                    <option value="Muaat">The Embers of Muaat</option>
                    <option value="Hacan">The Emirates of Hacan</option>
                    <option value="Sol">The Federation of Sol </option>
                    <option value="Ghosts" selected>The Ghosts of Creuss</option>
                    <option value="L1Z1X">The L1Z1X Mindnet</option>
                    <option value="Mentak">The Mentak Coalition</option>
                    <option value="Naalu">The Naalu Collective </option>
                    <option value="Nekro">The Nekro Virus</option>
                    <option value="Sardakk">The Sardakk N’orr</option>
                    <option value="Jol-Nar">The Universities of Jol-Nar</option>
                    <option value="Winnu">The Winnu</option>
                    <option value="Xxcha">The Xxcha Kingdom</option>
                    <option value="Yin">The Yin Brotherhood</option>
                    <option value="Yssaril ">The Yssaril Tribes </option>
                </select>
            </div>
        </div>
        <div class="player">
            <img class="icon" id="player6Icon" src="/icons/nekro.png">
            <div class="cf-form-field inline">
                <input type="text" value="Player 6 Name" class="cf-form-input inline" id="player6Name">
            </div>
            <div class="cf-form-field inline">
                <input type="integer" value="6" class="cf-form-input inline" id="player6Score">
            </div>
            <div class="cf-form-field inline">
                <select class="cf-form-input" id="player6Faction">
                    <option value="Arborec">The Arborec</option>
                    <option value="Barony">The Barony of Letnev</option>
                    <option value="Saar">The Clan of Saar </option>
                    <option value="Muaat">The Embers of Muaat</option>
                    <option value="Hacan">The Emirates of Hacan</option>
                    <option value="Sol">The Federation of Sol </option>
                    <option value="Ghosts">The Ghosts of Creuss</option>
                    <option value="L1Z1X">The L1Z1X Mindnet</option>
                    <option value="Mentak">The Mentak Coalition</option>
                    <option value="Naalu">The Naalu Collective </option>
                    <option value="Nekro" selected>The Nekro Virus</option>
                    <option value="Sardakk">The Sardakk N’orr</option>
                    <option value="Jol-Nar">The Universities of Jol-Nar</option>
                    <option value="Winnu">The Winnu</option>
                    <option value="Xxcha">The Xxcha Kingdom</option>
                    <option value="Yin">The Yin Brotherhood</option>
                    <option value="Yssaril ">The Yssaril Tribes </option>
                </select>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    window.contentfulExtension.init(function(extension) {

        var value = extension.field.getValue();
        setGameFields(value);

        $(".cf-form-input").on('input', function(event) {
            extension.field.setValue(getGameData());
        });



        function setGameFields(data) {
            for (i = 0; i < 6; i++) {
                document.getElementById(['player', i + 1, 'Name'].join('')).value = data['Players'][i]['Name'];
                document.getElementById(['player', i + 1, 'Score'].join('')).value = data['Players'][i]['Score'];
                $(['#', 'player', i + 1, 'Faction'].join('')).val(data['Players'][i]['Faction']).prop('selected', true);
                document.getElementById(['player', i + 1, 'Icon'].join('')).src = ["/icons/", data['Players'][i]['Faction'].toLowerCase() ,".png"];
            }

        }

        function getGameData() {
            var data = {};
            data['Players'] = [];
            var innerData = {};
            var i = 0;
            for (; i < document.getElementsByClassName('cf-form-input').length; i++) {
                switch (i % 3) {
                    case 0:
                        innerData = {};
                        innerData['Name'] = document.getElementsByClassName('cf-form-input')[i].value;
                        break;
                    case 1:
                        innerData['Score'] = document.getElementsByClassName('cf-form-input')[i].value;
                        break;
                    case 2:
                        innerData['Faction'] = document.getElementsByClassName('cf-form-input')[i].value;
                        document.getElementById(['player', i + 1, 'Icon'].join('')).src = ["/icons/", document.getElementsByClassName('cf-form-input')[i].value.toLowerCase(), ".png"];
                        data['Players'].push(innerData);
                        break;
                }
            }
            return (data);
        }


        extension.field.onValueChanged(function (data) {
            if (getGameData != data){
                setGameFields(data);
            }
        })

        extension.window.updateHeight()

    })
    </script>
</body>

</html>
